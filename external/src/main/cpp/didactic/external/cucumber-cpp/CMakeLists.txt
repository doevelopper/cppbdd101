
set(CUCUMBER_SOURCE_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/cucumber)
set(CUCUMBER_BUILD_DIRECTORY ${TARGET_BUILD_DIRECTORY}/cucumber-build)

file(MAKE_DIRECTORY ${CUCUMBER_BUILD_DIRECTORY}
)

set(CONFIGURE_FLAGS ${COMMON_CONFIGURE_FLAGS})

add_custom_command(OUTPUT ${APR_UTIL_BUILD_DIRECTORY}/Makefile
    COMMAND CC=${CMAKE_C_COMPILER} ${APR_UTIL_SOURCE_DIRECTORY}/configure ${CONFIGURE_FLAGS}
    DEPENDS gtest
    DEPENDS gmock
    WORKING_DIRECTORY ${CUCUMBER_BUILD_DIRECTORY}
)

add_custom_target(apr-util ALL make
    DEPENDS ${CUCUMBER_BUILD_DIRECTORY}/Makefile
    WORKING_DIRECTORY ${CUCUMBER_BUILD_DIRECTORY}
    COMMENT "Build of cucumber-cpp library"
)

#add_dependencies(gmock gtest)

install(
    DIRECTORY ${APR_UTIL_LIBS_DIRECTORY}/
    DESTINATION ${TARGET_BUILD_DIRECTORY}/lib
    USE_SOURCE_PERMISSIONS
    #FILES_MATCHING PATTERN libaprutil-1.so*
    FILES_MATCHING PATTERN libcucumber-cpp.*
)

mark_as_advanced( FORCE CUCUMBER_BUILD_DIRECTORY)
